{% extends 'base.html' %}
{% set css = 'forms.css' %}
{% set script = 'itens_nota.js' %}

{% block title %}Itens da Venda{% endblock %}

{% block content %}
<header class="page-header">
  <h1>ğŸ§¾ Itens da Venda {{ venda.numero }}</h1>
  <p class="muted">Cliente: <b>{{ venda.cliente }}</b></p>
</header>

<div class="grid-container">
  <!-- ==== FormulÃ¡rio ==== -->
  <div class="card">
    <h2>ğŸ›’ Adicionar Item</h2>
    <form method="POST" id="form-item" class="form-grid">

      <div class="form-group">
        <label>Produto</label>
        <select name="produto_id" id="produto" required>
          <option value="">Selecione...</option>
          {% for p in produtos %}
          <option value="{{ p.id }}" data-preco="{{ p.preco_venda }}">
            {{ p.descricao }} - R$ {{ "%.2f"|format(p.preco_venda) }}
          </option>
          {% endfor %}
        </select>
      </div>

      <div class="form-group">
        <label>Quantidade</label>
        <input type="number" name="quantidade" min="1" required>
      </div>

      <div class="form-group">
        <label>PreÃ§o UnitÃ¡rio (R$)</label>
        <input type="number" step="0.01" name="preco_unitario" id="preco_unitario" readonly
          style="background:#1e293b;cursor:not-allowed" required>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn-primary">â• Adicionar Item</button>
      </div>
    </form>
  </div>

  <!-- ==== Itens cadastrados ==== -->
  <div class="card">
    <h2>ğŸ“‹ Itens Cadastrados</h2>
    <table class="data-table">
      <thead>
        <tr>
          <th>Produto</th>
          <th>Quantidade</th>
          <th>PreÃ§o UnitÃ¡rio</th>
          <th>Subtotal</th>
        </tr>
      </thead>
      <tbody>
        {% for item in itens %}
        <tr>
          <td>{{ item.produto.descricao }}</td>
          <td>{{ item.quantidade }}</td>
          <td>R$ {{ "%.2f"|format(item.preco_unitario) }}</td>
          <td>R$ {{ "%.2f"|format(item.subTotal) }}</td>
        </tr>
        {% else %}
        <tr>
          <td colspan="4" style="text-align:center;color:#94a3b8;">Nenhum item adicionado ainda.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <div style="margin-top:1rem; text-align:right;">
      <p><strong>Total da Venda:</strong>
        <span style="color:#38bdf8;">R$ {{ "%.2f"|format(venda.valor_total) }}</span>
      </p>
    </div>

    <div class="form-actions" style="text-align:left;">
      <a href="{{ url_for('vendas') }}" class="btn-action" style="color:#38bdf8;">â† Voltar</a>
    </div>
  </div>
</div>
{% endblock %}