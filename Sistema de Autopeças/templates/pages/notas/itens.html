{% extends 'base.html' %}
{% set css = 'forms.css' %}
{% set script = 'itens_nota.js' %}

{% block title %}Itens da Nota{% endblock %}

{% block content %}
<header class="page-header">
  <h1>ðŸ“¦ Itens da Nota {{ nota.numero }}</h1>
  <div class="muted">Gerencie os produtos vinculados a esta nota fiscal</div>
</header>

<div class="page-content">
  <!-- ==== FORMULÃRIO DE ITENS ==== -->
  <section class="section">
    <h3>ðŸ§¾ Adicionar Item</h3>

    <form method="POST" id="form-item" class="modern-form">
      <div class="form-grid">
        <div class="form-group">
          <label>Produto</label>
          <select name="produto_id" id="produto" class="select2" required>
            <option value="">Selecione...</option>
            {% for p in produtos %}
            <option value="{{ p.id }}" data-preco="{{ p.preco_compra }}">
              {{ p.codigo }} - {{ p.descricao }} ({{ p.marca }}) - R$ {{ "%.2f"|format(p.preco_compra) }}
            </option>
            {% endfor %}
          </select>
        </div>

        <div class="form-group">
          <label>Quantidade</label>
          <input type="number" name="quantidade" min="1" required>
        </div>

        <div class="form-group">
          <label>PreÃ§o UnitÃ¡rio (R$)</label>
          <input type="number" step="0.01" name="preco_unitario" id="preco_unitario" readonly
            style="background:#0f172a;color:#94a3b8;" required>
        </div>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn-primary">Adicionar Item</button>
      </div>
    </form>
  </section>

  <!-- ==== LISTA DE ITENS ==== -->
  <section class="section">
    <h3>ðŸ“‹ Itens Cadastrados</h3>
    <table class="modern-table">
      <thead>
        <tr>
          <th>Produto</th>
          <th>Quantidade</th>
          <th>PreÃ§o UnitÃ¡rio</th>
          <th>Subtotal</th>
        </tr>
      </thead>
      <tbody>
        {% for item in itens %}
        <tr>
          <td>{{ item.produto.descricao }}</td>
          <td>{{ item.quantidade }}</td>
          <td>R$ {{ "%.2f"|format(item.preco_unitario) }}</td>
          <td>R$ {{ "%.2f"|format(item.subTotal) }}</td>
        </tr>
        {% else %}
        <tr>
          <td colspan="4" style="text-align:center;color:#94a3b8;">Nenhum item cadastrado.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <p class="total-nota">
      <b>Total da Nota:</b>
      <span>R$ {{ "%.2f"|format(nota.valor_total) }}</span>
    </p>

  </section>
</div>
{% endblock %}